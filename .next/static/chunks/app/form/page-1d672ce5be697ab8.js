(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[609],{7439:function(e,t,a){Promise.resolve().then(a.bind(a,580))},580:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return _}});var r=a(7437),n=a(2265),s=a(6463),l=a(5426),i=a(6648),o=e=>{let{image:t,index:a,removeImage:n,isEditing:s=!0}=e;return(0,r.jsxs)("div",{className:"relative m-2",children:[(0,r.jsx)(i.default,{src:t,alt:"Preview ".concat(a),width:100,height:100,className:"rounded"}),s&&(0,r.jsx)("button",{onClick:()=>n(a),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-5 h-5 leading-5",children:"x"})]})},c=a(4560),d=a(6993);function u(e){let{value:t,onChange:a,placeholder:n,onClick:s}=e;return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("textarea",{value:t,onChange:e=>a(e.target.value),placeholder:n,className:"p-2 border border-[#949494] rounded-lg resize-none min-h-[100px] w-full",rows:4}),(0,r.jsxs)("button",{type:"button",onClick:s,className:"absolute bottom-4 right-2 bg-transparent text-[#C7C7C7] flex items-center",children:[(0,r.jsx)(i.default,{src:"/images/lucide_wand.svg",width:16,height:16,alt:"wand"}),(0,r.jsx)("span",{className:"ml-1 text-[#8F8F8F] text-sm",children:"Try an example"})]})]})}function m(e){let{value:t,onChange:a,placeholder:n}=e;return(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)("textarea",{value:t,onChange:e=>a(e.target.value),placeholder:n,className:"p-2 border border-[#949494] rounded-lg resize-none min-h-[100px] w-full",rows:4})})}var h=a(418),p=a(1708),g=a(2649);async function f(e,t,a){let r=[],n=[],s=[],l=[],i=g.Z.get("auth-token"),o=e.map(async(e,t)=>{if(""===e.image_script||"Blank screen"===e.image_script||!0===e.has_product)return{content:{url:"",image_id:"",sceneNumber:e.scene,has_product:e.has_product}};try{let t=await fetch("".concat("http://localhost:8000","/image/generate-paid-image"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i)},body:JSON.stringify({prompt:e.image_script,outputTitle:e.image_title,script_id:a})});if(!t.ok)throw Error("Failed to generate AI image");let r=await t.json();return r.sceneNumber=e.scene,r.has_product=e.has_product,r}catch(e){return console.error("Error generating AI image:",e.message),{url:null,image_id:null}}}),c=await Promise.all(o);return console.log(c),c.forEach(e=>{e&&e.content&&e.content.url&&e.content.image_id&&e.sceneNumber&&!1===e.has_product&&(r.push(e.content.url),n.push(e.content.image_id),s.push(e.sceneNumber),l.push(e.has_product))}),{final_images:r,imageIds:n,sceneNumbers:s,hasProducts:l}}a(9792);var x=a(9792);async function b(e,t,a){var r;let n=null!==(r=x.env.BASE_URL)&&void 0!==r?r:"http://localhost:8000",s=g.Z.get("auth-token"),l=t.map(async e=>{let t=e.split(",")[1];return fetch("".concat(n,"/upload/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({content:t,content_type:a})}).then(e=>e.json())});return(await Promise.all(l)).map(e=>e.url)}var w=a(7485),j=e=>{let{apiCalls:t}=e,a=t.filter(e=>!e.isLoading).length/6*100;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-screen w-screen fixed top-0 left-0 z-50",children:[t.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center space-x-2 my-2 text-white",children:[(0,r.jsx)("span",{children:e.name}),e.isLoading?(0,r.jsx)(w.p2,{height:"20",width:"20",color:"#fff",ariaLabel:"loading"}):e.isError?(0,r.jsx)("span",{className:"error",children:"❌"}):(0,r.jsx)("span",{className:"check",children:"✅"}),e.responseTime&&(0,r.jsxs)("span",{children:["(",e.responseTime," ms)"]})]},t)),(0,r.jsxs)("div",{className:"w-1/4 bg-gray-200 rounded-full h-6 mb-4 relative",children:[(0,r.jsx)("div",{className:"bg-blue-500 h-6 rounded-full",style:{width:"".concat(a,"%")}}),(0,r.jsx)("span",{className:"absolute inset-0 flex items-center justify-center text-black font-semibold",children:"".concat(a.toFixed(2),"%")})]})]})},v=a(8827),N=a(1945);let y=async(e,t,a)=>{a(e,!0);try{let r=await t();return a(e,!1),r}catch(t){throw a(e,!1,!0),t}};function _(){let[e,t]=(0,n.useState)(null),[a,g]=(0,n.useState)([]),[x,w]=(0,n.useState)(""),[_,C]=(0,n.useState)(""),[I,S]=(0,n.useState)(""),[k,P]=(0,n.useState)(""),[A,E]=(0,n.useState)(""),[R,O]=(0,n.useState)(""),[T,D]=(0,n.useState)(!1),[F,B]=(0,n.useState)(!0),[L,Z]=(0,n.useState)(!1),[z,G]=(0,n.useState)([]),M=(0,s.useRouter)(),U=(0,n.useRef)(null),{user:H}=(0,v.a)(),{setUserId:J,setImageIds:q,setNoBgImageIds:W,setHasProductIndexes:Y}=(0,N.v)();(0,n.useEffect)(()=>{x&&I&&k&&A&&_&&a.length>0?B(!1):B(!0)},[x,I,k,A,_]);let K=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];G(r=>{let n=r.findIndex(t=>t.name===e),s={name:e,isLoading:t,isError:a};if(-1===n)return[...r,s];{let e=[...r];return e[n]=s,e}})},Q=e=>{g(t=>t.filter((t,a)=>a!==e))},V=async e=>{e.preventDefault(),Z(!0);let t={id:"".concat(Date.now()),title:x,product_description:_,video_description:R,width:I,height:k,length:A,images:a};try{let e=await y("Adding Review API",()=>(0,d.N_)(t,H,a),K),r=await y("Generating Image API",()=>$(e),K);J(H),q(r.imageIds),W(r.noBgImageIds),Y(r.hasProducts),M.push("/review/".concat(e.script_id))}catch(e){console.error("Error processing request",e)}},X=async(e,t,a)=>{let r={};return Object.keys(e).forEach(async n=>{"sceneNumbers"!==n&&"bgRemovedImageIds"!==n&&(r[n]=await a.map(a=>{let r=e.sceneNumbers.indexOf(a);if(-1!==r)return e[n][r];{let e=t.sceneNumbers.indexOf(a);return -1!==e?t[n][e]:null}}))}),r},$=async e=>{try{let t=await y("Uploading File to Supabase API",()=>b(H,a,"image/jpeg"),K),r=await y("Generating Image API",()=>(0,p.Z)(H,x,I,k,_,t,T,!1,[],e.narration_script,e.script_id),K),n=await y("Generating Multiple AI Images API",()=>f(e.narration_script,H,e.script_id),K),s=[...r.sceneNumbers,...n.sceneNumbers].sort((e,t)=>e-t),l=await y("Merging and Sorting by Scene Numbers",()=>X(r,n,s),K);return l.bgRemovedImageIds=r.bgRemovedImageIds,l}catch(e){console.error("Error generating image",e)}};return(0,r.jsxs)("main",{className:"flex-1 flex flex-col items-center p-24",children:[L?(0,r.jsx)(j,{apiCalls:z}):(0,r.jsxs)("div",{className:"w-full max-w-2xl flex flex-col justify-center items-center ".concat(L?"pointer-events-none opacity-50":""),children:[(0,r.jsx)("div",{className:"pb-10",children:(0,r.jsx)(i.default,{src:"/images/arcticons_form.svg",width:82,height:82,alt:"form icon"})}),(0,r.jsx)("div",{className:"mb-10",children:(0,r.jsx)(l.Z5,{onDragEnd:e=>{if(!e.destination)return;let t=Array.from(a),[r]=t.splice(e.source.index,1);t.splice(e.destination.index,0,r),g(t)},children:(0,r.jsx)(c.Z,{droppableId:"droppable",children:e=>(0,r.jsxs)("div",{...e.droppableProps,ref:e.innerRef,className:"flex flex-wrap",children:[a.map((e,t)=>(0,r.jsx)(l._l,{draggableId:"".concat(t),index:t,children:a=>(0,r.jsx)("div",{ref:a.innerRef,...a.draggableProps,...a.dragHandleProps,children:(0,r.jsx)(o,{index:t,image:e,removeImage:Q})})},t)),e.placeholder]})})})}),(0,r.jsxs)("form",{onSubmit:V,className:"flex flex-col space-y-4 max-w-xl w-full",children:[(0,r.jsx)("input",{disabled:a.length>=5,onChange:e=>{let t=Array.from(e.target.files);t.length>0&&Promise.all(t.map(e=>new Promise((t,a)=>{let r=new FileReader;r.onloadend=()=>{t(r.result)},r.onerror=a,r.readAsDataURL(e)}))).then(e=>{g(t=>[...t,...e].slice(0,5))}).catch(e=>{console.error("Error reading files",e)})},className:"block p-2 border border-[#949494] rounded-lg w-full",id:"multiple_files",type:"file",accept:"image/png, image/gif, image/jpeg",multiple:!0}),(0,r.jsx)("input",{type:"text",value:x,onChange:e=>w(e.target.value),placeholder:"Title",className:"p-2 border border-[#949494] rounded-lg w-full"}),(0,r.jsx)(m,{value:_,onChange:C,placeholder:"Product Description"}),(0,r.jsx)(u,{value:R,onChange:O,onClick:e=>{e.preventDefault(),U.current.showModal()},placeholder:"(Optional) Describe what kind of video you want."}),(0,r.jsxs)("div",{className:"flex space-x-2 w-full",children:[(0,r.jsx)("input",{type:"number",value:I,onChange:e=>S(e.target.value),placeholder:"Width",className:"p-2 border border-[#949494] rounded-lg flex-1 min-w-0"}),(0,r.jsx)("input",{type:"number",value:k,onChange:e=>P(e.target.value),placeholder:"Height",className:"p-2 border border-[#949494] rounded-lg flex-1 min-w-0"}),(0,r.jsx)("input",{type:"number",value:A,onChange:e=>E(e.target.value),placeholder:"Length",className:"p-2 border border-[#949494] rounded-lg flex-1 min-w-0"})]}),(0,r.jsx)("div",{className:"flex justify-end w-full",children:(0,r.jsx)("button",{type:"submit",className:"p-2 w-1/2 bg-[#4F4CDB] rounded text-white ".concat(F?"opacity-60":""),disabled:F,children:"Generate & Edit"})})]})]}),(0,r.jsx)(h.Z,{ref:U,title:"Try this example!",onCancel:()=>U.current.closeModal(),outerClassName:"bg-white",titleClassName:"text-black",children:(0,r.jsx)("p",{className:"text-black",children:"You will be charged after this point and cannot revert your action. Do you want to proceed with this information?"})})]})}}},function(e){e.O(0,[218,216,571,90,483,588,183,690,971,23,744],function(){return e(e.s=7439)}),_N_E=e.O()}]);